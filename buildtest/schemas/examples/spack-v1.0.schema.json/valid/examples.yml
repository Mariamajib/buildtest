version: "1.0"
buildspecs:
  env_create_name:
    type: spack
    executor: generic.local.sh
    spack:
      root: $HOME/spack/
      env:
        create:
          name: myproject
        specs:
          - m4
          - zlib
      install:
        options: ''
  env_activate:
    type: spack
    executor: generic.local.sh
    spack:
      root: $HOME/spack/
      env:
        activate:
          name: myproject
        specs:
          - m4
          - zlib
      install:
        options: ''

  env_create_directory:
    type: spack
    executor: generic.local.sh
    spack:
      root: $HOME/spack/
      env:
        create:
          directory: $HOME/spack-env/myproject
        specs:
          - 'm4'
          - 'zlib@1.2.11'
      install:
        options: '--cache-only'

  env_create_from_manifest:
    type: spack
    executor: generic.local.sh
    spack:
      root: $HOME/spack/
      env:
        create:
          name: myproject
          manifest: $HOME/spack.yaml
      install:
        options: '--cache-only'

  env_concretized_install:
    type: spack
    description: run 'spack concretize -f' in an environment and install specs
    executor: generic.local.sh
    spack:
      root: $HOME/spack/
      env:
        create:
          name: myproject
          manifest: $HOME/spack.yaml
        concretize: true
      install:
        options: '--cache-only'

  env_mirror:
    type: spack
    executor: generic.local.sh
    description: declare spack mirror 'spack mirror add h5 /path/to/mirror' in environment
    spack:
      root: $HOME/spack/
      env:
        mirror:
          h5: /path/to/mirror
        create:
          name: myproject
          manifest: $HOME/spack.yaml
      install:
        options: '--cache-only'

  install_without_env:
    type: spack
    executor: generic.local.sh
    description: install specs without environment
    spack:
      root: $HOME/spack/
      install:
        options: '--cache-only'
        specs: ['m4', 'bzip2']


  pre_post_cmd_spack_install:
    type: spack
    executor: generic.local.sh
    description: run commands before and after spack using pre_cmds and post_cmds
    pre_cmds: |
      cd $HOME
      git clone https://github.com/spack/spack
    spack:
      root: $HOME/spack/
      install:
        options: '--cache-only'
        specs: ['m4', 'bzip2']
    post_cmds: |
      spack find